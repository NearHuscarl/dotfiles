#!/bin/env bash

# Dependencies:
# rofi
# surfraw

# Usage:
# $ ./bookmarks

set -o errexit
set -o pipefail
# set -o nounset
# set -o xtrace

SCRIPT_NAME=$(basename "$0")
USAGE="Usage: "$SCRIPT_NAME" [help|edit]"
HELP="\
"$SCRIPT_NAME" [<command>]
Commands:
  h, help      print this help message
  e, edit      edit bookmarks list
When command is omitted, Open bookmark menu
Selected bookmark will be opened in \$BROWSER"

BOOKMARK=$HOME/.config/surfraw/bookmarks

if [[ ! -v EDITOR ]]; then
	EDITOR=vim
fi


function die () {
	echo "$*" >&2
	exit 1
}

function usage() {
	die "$USAGE"
}

function help() {
	echo "$HELP"
}

function edit_bookmarks() {
	"$EDITOR" "$BOOKMARK"
}

function get_bookmarks() {
	local bookmarks=$(cat "$BOOKMARK")
	bookmarks=$(echo "$bookmarks" | sed '/^$/d' | sed '/^#/d' | sed '/^\//d')
	echo "$bookmarks" | sort -n
}

function open_rofi() {
	get_bookmarks | rofi -dmenu -mesg 'add more bookmark at: ~/.config/surfraw/bookmarks' -i -p 'bookmarks: '
}

function open_bookmark() {
	surfraw -browser=$BROWSER "$(open_rofi)" 1> /dev/null
}

function main() {
	local cmd="$1"

	case "$#" in
		0)
			open_bookmark ;;
		*)
			case "$cmd" in
				h|help)
					help ;;
				e|edit)
					edit_bookmarks ;;
				*)
					usage ;;
			esac
	esac
}

main "$@"
